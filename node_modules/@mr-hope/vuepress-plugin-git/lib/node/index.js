"use strict";
const check_1 = require("./check");
const contributor_1 = require("./contributor");
const time_1 = require("./time");
const gitPlugin = (options, { cwd }) => {
    const isGitRepoValid = (0, check_1.checkGitRepo)(cwd);
    return {
        name: "git",
        async extendPageData(page) {
            if (isGitRepoValid && page._filePath) {
                const { transformer } = options;
                const { $lang } = page._computed;
                const createTimeStamp = await (0, time_1.getCreatedTimeStamp)(page._filePath);
                const updateTimeStamp = await (0, time_1.getUpdatedTimeStamp)(page._filePath);
                if (updateTimeStamp) {
                    const updatedTime = typeof transformer === "function"
                        ? transformer(updateTimeStamp, $lang)
                        : (0, time_1.defaultTransformer)(updateTimeStamp, $lang, options.timezone);
                    page.updateTime = updatedTime;
                    page.updateTimeStamp = updateTimeStamp;
                }
                if (createTimeStamp) {
                    const createTime = typeof transformer === "function"
                        ? transformer(createTimeStamp, $lang)
                        : (0, time_1.defaultTransformer)(createTimeStamp, $lang, options.timezone);
                    page.createTime = createTime;
                    page.createTimeStamp = createTimeStamp;
                }
                if (options.contributor !== false)
                    page.contributors = await (0, contributor_1.getContributors)(page._filePath);
            }
        },
    };
};
module.exports = gitPlugin;
//# sourceMappingURL=index.js.map